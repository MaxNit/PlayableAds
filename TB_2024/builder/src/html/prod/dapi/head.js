function getScript(e,i){var t=document.createElement("script");t.type="text/javascript",t.async=!0,i&&(t.onload=i),t.src=e,document.head.appendChild(t)}function parseMessage(e){var i=e.data,t=i.indexOf(DOLLAR_PREFIX+RECEIVE_MSG_PREFIX);return -1!==t?getMessageParams(i.slice(t+2)):{}}function getMessageParams(e){var i,t=[],n=e.split("/"),a=n.length;if(-1===e.indexOf(RECEIVE_MSG_PREFIX)){if(a>=2&&a%2==0)for(i=0;a>i;i+=2)t[n[i]]=n.length<i+1?null:decodeURIComponent(n[i+1])}else{var s=e.split(RECEIVE_MSG_PREFIX);void 0!==s[1]&&(t=JSON&&JSON.parse(s[1]))}return t}function getDapi(e){var i=parseMessage(e);(!i||i.name===GET_DAPI_URL_MSG_NAME)&&getScript(i.data,onDapiReceived)}function invokeDapiListeners(){for(var e in dapiEventsPool)dapiEventsPool.hasOwnProperty(e)&&dapi.addEventListener(e,dapiEventsPool[e])}function onDapiReceived(){dapi=window.dapi,window.removeEventListener("message",getDapi),invokeDapiListeners()}function init(){window.dapi.isDemoDapi&&(window.parent.postMessage(DOLLAR_PREFIX+SEND_MSG_PREFIX+JSON.stringify({state:"getDapiUrl"}),"*"),window.addEventListener("message",getDapi,!1))}var DOLLAR_PREFIX="$$",RECEIVE_MSG_PREFIX="DAPI_SERVICE:",SEND_MSG_PREFIX="DAPI_AD:",GET_DAPI_URL_MSG_NAME="connection.getDapiUrl",dapiEventsPool={},dapi=window.dapi||{isReady:function(){return!1},addEventListener:function(e,i){dapiEventsPool[e]=i},removeEventListener:function(e){delete dapiEventsPool[e]},isDemoDapi:!0};init();